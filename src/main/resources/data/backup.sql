create database JURISDB_METRICS;
use JURISDB_METRICS;

CREATE TABLE If Not Exists JURISDB_METRICS.CabConsultaIA (
  id bigint unsigned primary key not null auto_increment,
  userId bigint DEFAULT NULL Comment 'ID de Usuario',
  countMessages int default 0 Comment 'Cantidad de mensajes procesados',
  firstSendMessage text Null Comment 'Primer mensaje enviado por el usuario',
  lastSendMessage text Null Comment 'Ultimo mensaje enviado por el usuario',
  firstResponseMessage text Null Comment 'Primer mensaje de respuesta de la IA',
  lastResponseMessage text Null Comment 'Ultimo mensaje de respuesta de la IA',
  sessionUID char(50) DEFAULT NULL Comment 'ID de Sesión de consulta a la IA',
  regDate date Null Comment 'Fecha create',
  regDatetime datetime Null Comment 'Fecha Hora create',
  regTimestamp bigint Null Comment 'Epoch create',
  updDate date Null Comment 'Fecha Update',
  updDatetime datetime Null Comment 'Fecha Hora Update',
  updTimestamp bigint Null Comment 'Epoch Update'
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci,
COMMENT = 'Tabla de Cabecera de Consultas a la IA (Inteligencia Artificial)';
-- Indexacion
ALTER TABLE JURISDB_METRICS.CabConsultaIA
    ADD INDEX userIdIDX (userId),
    ADD INDEX countMessagesIDX (countMessages),
    ADD INDEX sessionUIDIDX (sessionUID),
    ADD INDEX regDateIDX (regDate),
    ADD INDEX regDatetimeIDX (regDatetime),
    ADD INDEX regTimestampIDX (regTimestamp),
    ADD INDEX updDateIDX (updDate),
    ADD INDEX updDatetimeIDX (updDatetime),
    ADD INDEX updTimestampIDX (updTimestamp);


CREATE TABLE If Not Exists JURISDB_METRICS.DetailConsultaIA (
  id bigint unsigned primary key not null auto_increment,
  userId bigint DEFAULT NULL Comment 'ID de Usuario',
  model char(50) DEFAULT NULL Comment 'Modelo de IA utilizado',
  roleSystem text DEFAULT NULL Comment 'Rol del Modelo de IA',
  sendMessage text DEFAULT NULL Comment 'Mensaje enviado por el usuario',
  temperature decimal(3,1) DEFAULT NULL Comment 'Temperatura de la IA',
  fechaSend datetime DEFAULT NULL Comment 'Fecha de envio del mensaje',
  fechaResponse datetime DEFAULT NULL Comment 'Fecha de respuesta de la IA',
  idGpt char(100) DEFAULT NULL Comment 'ID de la consulta a la IA',
  object char(100) DEFAULT NULL Comment 'Objeto de la consulta a la IA',
  created bigint DEFAULT NULL Comment 'Fecha de creación de la consulta a la IA',
  modelResponse char(100) DEFAULT NULL Comment 'Modelo de IA utilizado en la respuesta',
  roleResponse char(100) DEFAULT NULL Comment 'Rol del Modelo de IA en la respuesta',
  responseMessage text DEFAULT NULL Comment 'Mensaje enviado por el usuario',
  refusal text DEFAULT NULL Comment 'Mensaje de rechazo de la IA',
  logprobs bigint DEFAULT NULL Comment 'Logprobs de la IA',
  finishReason text DEFAULT NULL Comment 'Razón de finalización de la consulta a la IA',
  promptTokens int DEFAULT NULL Comment 'Tokens de entrada de la consulta a la IA',
  completionTokens int DEFAULT NULL Comment 'Tokens de salida de la consulta a la IA',
  totalTokens int DEFAULT NULL Comment 'Tokens totales de la consulta a la IA',
  cachedTokens int DEFAULT NULL Comment 'Tokens cacheados de la consulta a la IA',
  audioTokens int DEFAULT NULL Comment 'Tokens de audio de la consulta a la IA',
  CompletionReasoningTokens int DEFAULT NULL Comment 'Tokens de razonamiento de la consulta a la IA',
  CompletionAudioTokens int DEFAULT NULL Comment 'Tokens de audio de la consulta a la IA',
  CompletionAceptedTokens int DEFAULT NULL Comment 'Tokens aceptados de la consulta a la IA',
  CompletionRejectedTokens int DEFAULT NULL Comment 'Tokens rechazados de la consulta a la IA',
  serviceTier char(250) DEFAULT NULL Comment 'Nivel de servicio de la IA',
  systemFingerprint char(250) DEFAULT NULL Comment 'Huella digital del sistema que realizó la consulta a la IA',
  ConfigurationsId int NOT NULL Comment 'ID de Configuración de la IA',
  sessionUID char(50) NOT NULL Comment 'ID de Sesión de consulta a la IA',
  status tinyint DEFAULT NULL Comment 'Estado de la consulta a la IA (0: pendiente, 1: completada, 2: error)',
  regDate date Null Comment 'Fecha create',
  regDatetime datetime Null Comment 'Fecha Hora create',
  regTimestamp bigint Null Comment 'Epoch create'
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci,
COMMENT = 'Tabla de Cabecera de Consultas a la IA (Inteligencia Artificial)';
-- Indexacion
ALTER TABLE JURISDB_METRICS.DetailConsultaIA
    ADD INDEX userIdIDX (userId),
    ADD INDEX modelIDX (model),
    ADD INDEX fechaSendIDX (fechaSend),
    ADD INDEX fechaResponseIDX (fechaResponse),
    ADD INDEX idGptIDX (idGpt),
    ADD INDEX objectIDX (object),
    ADD INDEX createdIDX (created),
    ADD INDEX modelResponseIDX (modelResponse),
    ADD INDEX logprobsIDX (logprobs),
    ADD INDEX serviceTierIDX (serviceTier),
    ADD INDEX ConfigurationsIdIDX (ConfigurationsId),
    ADD INDEX sessionUIDIDX (sessionUID),
    ADD INDEX regDateIDX (regDate),
    ADD INDEX regDatetimeIDX (regDatetime),
    ADD INDEX regTimestampIDX (regTimestamp);


CREATE TABLE If Not Exists JURISDB_METRICS.CabDocumentoGenerado (
  id bigint unsigned primary key not null auto_increment,
  userId bigint DEFAULT NULL Comment 'ID de Usuario',
  typedoc char(20) DEFAULT NULL Comment 'Tipo de Generacion: web | doc',
  codSede char(20) DEFAULT NULL Comment 'Codigo de Sede en el SIJ',
  codInstancia char(20) DEFAULT NULL Comment 'Codigo de Instancia en el SIJ',
  codEspecialidad char(20) DEFAULT NULL Comment 'Codigo de Especialidad en el SIJ',
  codMateria char(20) DEFAULT NULL Comment 'Codigo de Materia en el SIJ',
  sede char(200) DEFAULT NULL Comment 'Nombre de Sede en el SIJ',
  instancia char(200) DEFAULT NULL Comment 'Nombre de Instancia en el SIJ',
  especialidad char(200) DEFAULT NULL Comment 'Nombre de Especialidad en el SIJ',
  materia char(200) DEFAULT NULL Comment 'Nombre de Materia en el SIJ',
  codNumero char(20) DEFAULT NULL Comment 'Numero del Expediente en el SIJ',
  codYear char(20) DEFAULT NULL Comment 'Año del Expediente en el SIJ',
  idDocumento int DEFAULT NULL Comment 'ID del Documento generado',
  idTipoDocumento int DEFAULT NULL Comment 'ID del Tipo de Documento generado',
  tipoDocumento char(150) DEFAULT NULL Comment 'Tipo de Documento generado',
  documento char(200) DEFAULT NULL Comment 'Documento generado',
  nUnico bigint unsigned DEFAULT NULL Comment 'Numero Unico del Expediente',
  xFormato char(50) DEFAULT NULL Comment 'Formato del Expediente',
  ubicacion char(200) DEFAULT NULL Comment 'Ubicacion del Expediente',
  juez char(200) DEFAULT NULL Comment 'Juez del Expediente',
  estado char(200) DEFAULT NULL Comment 'Estado del Expediente',
  dniDemandante char(100) DEFAULT NULL Comment 'DNI de Demandante del Expediente',
  demandante char(250) DEFAULT NULL Comment 'Demandante del Expediente',
  dniDemandado char(100) DEFAULT NULL Comment 'DNI de Demandado del Expediente',
  demandado char(250) DEFAULT NULL Comment 'Demandado del Expediente',
  templateCode char(50) DEFAULT NULL Comment 'Codigo del Template',
  templateID bigint unsigned DEFAULT NULL Comment 'ID del Template de Salida',
  templateNombreOut char(200) DEFAULT NULL Comment 'Nombre del Template de Salida',

  regDate date Null Comment 'Fecha create',
  regDatetime datetime Null Comment 'Fecha Hora create',
  regTimestamp bigint Null Comment 'Epoch create'
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci,
COMMENT = 'Tabla de Documentos Generados por la IA (Inteligencia Artificial)';
-- Indexacion
ALTER TABLE JURISDB_METRICS.CabDocumentoGenerado
    ADD INDEX userIdIDX (userId),
    ADD INDEX codSedeIDX (codSede),
    ADD INDEX codInstanciaIDX (codInstancia),
    ADD INDEX codEspecialidadIDX (codEspecialidad),
    ADD INDEX codMateriaIDX (codMateria),
    ADD INDEX codNumeroIDX (codNumero),
    ADD INDEX codYearIDX (codYear),
    ADD INDEX idDocumentoIDX (idDocumento),
    ADD INDEX idTipoDocumentoIDX (idTipoDocumento),
    ADD INDEX nUnicoIDX (nUnico),
    ADD INDEX xFormatoIDX (xFormato),
    ADD INDEX dniDemandanteIDX (dniDemandante),
    ADD INDEX dniDemandadoIDX (dniDemandado),
    ADD INDEX templateCodeIDX (templateCode),
    ADD INDEX templateIDIDX (templateID),
    ADD INDEX regDateIDX (regDate),
    ADD INDEX regDatetimeIDX (regDatetime),
    ADD INDEX regTimestampIDX (regTimestamp);
